<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="stylesheet" href="index.css">
  <title>用户登录 - 旅游行业管理与运行调度系统</title>
</head>

<body>
<div class="box">
  <div class="left"></div>
  <div class="right">
    <h4>登 录</h4>
    <form id="Login-form">
      <input class="acc" type="text" name="name" id="username" placeholder="用户名" required>
      <input class="acc" type="password" name="psw" id="password" placeholder="密码" required>
      <input class="submit" type="submit" value="登录">
    </form>
    <div class="fn">
      <a href="SetUp.html" style="text-decoration: none; color: #3498db;">注册账号</a>
      <span style="margin: 0 10px;"></span>
      <a href="javascript:void(0);" onclick="alert('找回密码功能暂未开放，请联系管理员')" style="text-decoration: none; color: #7f8c8d;">找回密码</a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('Login-form');
    if (!form) return;

    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      const name = document.getElementById('username').value.trim();
      const psw = document.getElementById('password').value.trim();

      if (!name || !psw) {
        alert('请输入用户名和密码');
        return;
      }

      const url = `http://localhost:8080/users/login?name=${encodeURIComponent(name)}&psw=${encodeURIComponent(psw)}`;

      try {
        const resp = await fetch(url, { method: 'GET' });
        const result = await resp.json();

        if (result.success && result.userId) {
          // 保存登录状态和用户信息
          sessionStorage.setItem('isLoggedIn', 'true');
          sessionStorage.setItem('username', result.username || name);
          sessionStorage.setItem('userId', result.userId);
          sessionStorage.setItem('loginTime', new Date().getTime().toString());

          alert('登录成功！');
          // 登录成功后跳转到主界面
          window.location.href = 'MainMenu.html';
        } else {
          alert(result.message || '登录失败，请检查用户名和密码');
        }
      } catch (err) {
        console.error('登录错误:', err);
        alert('登录请求失败，请检查网络连接或后端服务是否启动');
      }
    });
  });
</script>
</body>
</html>